# 测试验证文档

## 1. 功能测试

### 1.1 注册功能测试

#### 1.1.1 测试步骤

1. **访问注册页面**
   - 打开浏览器，访问 `http://localhost:5173/register`

2. **输入无效数据**
   - 测试场景1：用户名为空
     - 操作：仅输入邮箱和密码，用户名留空
     - 预期结果：显示错误信息"用户名不能为空"
   
   - 测试场景2：用户名长度不符合要求（<3个字符）
     - 操作：输入"ab"作为用户名
     - 预期结果：显示错误信息"用户名长度必须在3-20个字符之间"
   
   - 测试场景3：用户名长度不符合要求（>20个字符）
     - 操作：输入21个字符以上的用户名
     - 预期结果：显示错误信息"用户名长度必须在3-20个字符之间"
   
   - 测试场景4：邮箱格式不正确
     - 操作：输入"invalid-email"作为邮箱
     - 预期结果：显示错误信息"请输入有效的邮箱地址"
   
   - 测试场景5：密码不符合安全要求（<8个字符）
     - 操作：输入"1234567"作为密码
     - 预期结果：显示错误信息"密码必须包含大小写字母、数字和特殊符号，至少8位"
   
   - 测试场景6：密码不符合安全要求（缺少特殊符号）
     - 操作：输入"Password123"作为密码
     - 预期结果：显示错误信息"密码必须包含大小写字母、数字和特殊符号，至少8位"
   
   - 测试场景7：密码和确认密码不匹配
     - 操作：输入不同的密码和确认密码
     - 预期结果：显示错误信息"两次输入的密码不一致"

3. **输入有效数据**
   - 测试场景：注册新用户
     - 操作：输入有效的用户名、邮箱和符合要求的密码
     - 预期结果：
       - 显示成功信息"注册成功，请查收邮箱验证邮件"
       - 表单被重置
       - 数据库中新增用户记录，状态为未验证

4. **测试重复注册**
   - 测试场景1：使用已存在的用户名注册
     - 操作：使用已注册的用户名和新邮箱注册
     - 预期结果：显示错误信息"用户名已存在"
   
   - 测试场景2：使用已存在的邮箱注册
     - 操作：使用新用户名和已注册的邮箱注册
     - 预期结果：显示错误信息"邮箱已存在"

### 1.2 邮箱验证功能测试

#### 1.2.1 测试步骤

1. **获取验证链接**
   - 从数据库中获取用户的`verification_token`
   - 构建验证链接：`http://localhost:5173/api/verify-email?token={verification_token}`

2. **测试有效验证令牌**
   - 测试场景：使用有效的验证令牌
     - 操作：在浏览器中访问构建好的验证链接
     - 预期结果：显示"邮箱验证成功！您现在可以登录了"
     - 数据库中用户的`email_verified`字段更新为1，`verification_token`和`verification_expires`字段清空

3. **测试无效验证令牌**
   - 测试场景：使用无效的验证令牌
     - 操作：在浏览器中访问`http://localhost:5173/api/verify-email?token=invalid-token`
     - 预期结果：显示"无效的验证令牌"

4. **测试过期验证令牌**
   - 测试场景：使用过期的验证令牌
     - 操作：
       1. 在数据库中手动将`verification_expires`字段设置为过去的时间
       2. 访问验证链接
     - 预期结果：显示"验证令牌已过期"

### 1.3 登录功能测试

#### 1.3.1 测试步骤

1. **访问登录页面**
   - 打开浏览器，访问 `http://localhost:5173/login`

2. **输入无效数据**
   - 测试场景1：邮箱为空
     - 操作：仅输入密码，邮箱留空
     - 预期结果：显示错误信息"邮箱不能为空"
   
   - 测试场景2：邮箱格式不正确
     - 操作：输入"invalid-email"作为邮箱
     - 预期结果：显示错误信息"请输入有效的邮箱地址"
   
   - 测试场景3：密码为空
     - 操作：仅输入邮箱，密码留空
     - 预期结果：显示错误信息"密码不能为空"

3. **测试无效凭证**
   - 测试场景：使用错误的邮箱或密码
     - 操作：输入有效的邮箱格式和错误的密码
     - 预期结果：显示错误信息"邮箱或密码错误"

4. **测试未验证邮箱登录**
   - 测试场景：使用未验证邮箱登录
     - 操作：使用已注册但未验证的邮箱和正确密码登录
     - 预期结果：显示错误信息"请先验证邮箱"

5. **测试账户锁定**
   - 测试场景：连续5次输入错误密码
     - 操作：
       1. 连续5次输入错误密码
       2. 第6次尝试登录
     - 预期结果：显示错误信息"账户已被锁定，请30分钟后重试"

6. **测试有效凭证登录**
   - 测试场景1：使用已验证邮箱和正确密码登录
     - 操作：输入有效的邮箱和密码，不勾选"记住我"
     - 预期结果：
       - 显示成功信息"登录成功！"
       - 跳转到首页
       - 会话Cookie设置为24小时过期
   
   - 测试场景2：使用"记住我"选项
     - 操作：输入有效的邮箱和密码，勾选"记住我"
     - 预期结果：
       - 显示成功信息"登录成功！"
       - 跳转到首页
       - 会话Cookie设置为30天过期

7. **测试已登录用户访问登录页面**
   - 测试场景：已登录用户访问/login
     - 操作：
       1. 成功登录
       2. 在浏览器地址栏输入`http://localhost:5173/login`
     - 预期结果：自动跳转到/profile页面

### 1.4 登出功能测试

#### 1.4.1 测试步骤

1. **登录系统**
   - 使用有效的凭证登录系统

2. **点击登出按钮**
   - 操作：在个人资料页面点击"退出"按钮
   - 预期结果：
     - 会话Cookie被清除
     - 用户认证状态更新为未登录
     - 跳转到首页

3. **测试登出后访问受保护页面**
   - 测试场景：登出后访问/profile
     - 操作：
       1. 成功登出
       2. 在浏览器地址栏输入`http://localhost:5173/profile`
     - 预期结果：自动跳转到/login页面

## 2. 安全测试

### 2.1 SQL注入测试

#### 2.1.1 测试步骤

1. **测试注册功能**
   - 测试场景：注册时输入SQL注入字符串
     - 操作：在注册表单中输入以下用户名：`admin' --`
     - 预期结果：
       - 表单验证失败或成功注册，但不会导致SQL注入攻击
       - 数据库中不会创建名为`admin`的用户

2. **测试登录功能**
   - 测试场景：登录时输入SQL注入字符串
     - 操作：在登录表单中输入以下邮箱：`admin' OR '1'='1`
     - 预期结果：
       - 登录失败，显示"邮箱或密码错误"
       - 不会绕过认证直接登录

### 2.2 XSS攻击测试

#### 2.2.1 测试步骤

1. **测试注册功能**
   - 测试场景：注册时输入XSS脚本
     - 操作：在注册表单中输入以下用户名：`<script>alert('XSS')</script>`
     - 预期结果：
       - 表单验证失败或成功注册，但脚本不会执行
       - 数据库中存储的是转义后的字符串，而不是原始脚本

2. **测试登录功能**
   - 测试场景：登录时输入XSS脚本
     - 操作：在登录表单中输入以下邮箱：`<script>alert('XSS')</script>`
     - 预期结果：
       - 登录失败，显示"请输入有效的邮箱地址"
       - 脚本不会执行

### 2.3 CSRF攻击测试

#### 2.3.1 测试步骤

1. **测试CSRF保护**
   - 测试场景：模拟CSRF攻击
     - 操作：
       1. 创建一个包含恶意表单的HTML文件，提交到登录API
       2. 使用已登录的浏览器访问该HTML文件
     - 预期结果：
       - 登录请求失败
       - 不会导致会话被劫持

### 2.4 密码安全测试

#### 2.4.1 测试步骤

1. **检查密码存储**
   - 测试场景：查看数据库中的密码存储
     - 操作：在Cloudflare D1控制面板中查看users表
     - 预期结果：
       - 密码以哈希形式存储，格式为`hash:salt`
       - 没有明文密码

2. **测试密码验证**
   - 测试场景：使用正确的密码登录
     - 操作：使用正确的密码登录
     - 预期结果：登录成功
   
   - 测试场景：使用错误的密码登录
     - 操作：使用错误的密码登录
     - 预期结果：登录失败，显示"邮箱或密码错误"

## 3. 性能测试

### 3.1 API响应时间测试

#### 3.1.1 测试步骤

1. **测试注册API**
   - 测试场景：测量注册API的响应时间
     - 操作：使用工具如Postman或curl发送注册请求
     - 预期结果：响应时间应小于500ms

2. **测试登录API**
   - 测试场景：测量登录API的响应时间
     - 操作：使用工具如Postman或curl发送登录请求
     - 预期结果：响应时间应小于500ms

## 4. 兼容性测试

### 4.1 浏览器兼容性测试

#### 4.1.1 测试步骤

1. **测试主流浏览器**
   - 测试场景：在不同浏览器中测试功能
     - 操作：分别在以下浏览器中测试注册、登录和登出功能
       - Chrome（最新版本）
       - Firefox（最新版本）
       - Safari（最新版本）
       - Edge（最新版本）
     - 预期结果：所有功能在各浏览器中都能正常工作

2. **测试移动浏览器**
   - 测试场景：在移动浏览器中测试功能
     - 操作：分别在iOS Safari和Android Chrome中测试注册、登录和登出功能
     - 预期结果：所有功能在移动浏览器中都能正常工作，布局自适应

## 5. 测试工具推荐

1. **功能测试**
   - 手动测试：浏览器
   - 自动化测试：
     - Cypress：用于端到端测试
     - Jest + React Testing Library：用于组件测试

2. **安全测试**
   - OWASP ZAP：用于自动化安全测试
   - SQLMap：用于SQL注入测试
   - XSSer：用于XSS攻击测试

3. **性能测试**
   - Postman：用于API响应时间测试
   - LoadRunner：用于负载测试
   - JMeter：用于性能测试

## 6. 测试结果记录

| 测试项 | 测试场景 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|------|
| 注册功能 | 用户名为空 | 显示错误信息 | | | |
| 注册功能 | 用户名长度不符合要求 | 显示错误信息 | | | |
| 注册功能 | 邮箱格式不正确 | 显示错误信息 | | | |
| 注册功能 | 密码不符合安全要求 | 显示错误信息 | | | |
| 注册功能 | 密码和确认密码不匹配 | 显示错误信息 | | | |
| 注册功能 | 有效数据注册 | 注册成功 | | | |
| 注册功能 | 重复注册 | 显示错误信息 | | | |
| 邮箱验证 | 有效令牌 | 验证成功 | | | |
| 邮箱验证 | 无效令牌 | 显示错误信息 | | | |
| 邮箱验证 | 过期令牌 | 显示错误信息 | | | |
| 登录功能 | 无效凭证 | 登录失败 | | | |
| 登录功能 | 未验证邮箱登录 | 显示错误信息 | | | |
| 登录功能 | 账户锁定 | 显示错误信息 | | | |
| 登录功能 | 有效凭证登录 | 登录成功 | | | |
| 登出功能 | 点击登出按钮 | 登出成功 | | | |
| 安全测试 | SQL注入 | 无SQL注入 | | | |
| 安全测试 | XSS攻击 | 无XSS攻击 | | | |
| 安全测试 | CSRF攻击 | 无CSRF攻击 | | | |
| 安全测试 | 密码存储 | 哈希存储 | | | |

## 7. 测试环境

- 操作系统：Windows/macOS/Linux
- 浏览器：Chrome、Firefox、Safari、Edge
- 开发环境：Vite + React
- 后端环境：Cloudflare Pages Functions + D1
- 数据库：Cloudflare D1

## 8. 测试结论

完成所有测试后，根据测试结果撰写测试结论，包括：

1. 功能测试结果：所有功能是否正常工作
2. 安全测试结果：是否存在安全漏洞
3. 性能测试结果：系统性能是否符合要求
4. 兼容性测试结果：系统是否兼容主流浏览器
5. 建议和改进：针对测试中发现的问题提出改进建议
